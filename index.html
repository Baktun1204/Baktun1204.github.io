<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LS Sound-OS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'off-white': '#F5F5F7',
            'deep-slate': '#1F2937',
            'champagne': '#D4AF37',
            'sage': '#84A98C',
            'terra': '#E07A5F',
            'glass': 'rgba(255,255,255,0.65)',
            'glass-border': 'rgba(255,255,255,0.3)',
          },
          fontFamily: {
            'system': ['-apple-system', 'BlinkMacSystemFont', 'Apple SD Gothic Neo', 'Pretendard', 'Roboto', 'Noto Sans KR', 'sans-serif'],
          },
          boxShadow: {
            'neu-out': '6px 6px 12px rgba(0,0,0,0.08), -6px -6px 12px rgba(255,255,255,0.9)',
            'neu-in': 'inset 4px 4px 8px rgba(0,0,0,0.06), inset -4px -4px 8px rgba(255,255,255,0.8)',
            'neu-btn': '4px 4px 8px rgba(0,0,0,0.07), -4px -4px 8px rgba(255,255,255,0.85)',
            'neu-btn-pressed': 'inset 2px 2px 4px rgba(0,0,0,0.08), inset -2px -2px 4px rgba(255,255,255,0.6)',
            'glass': '0 8px 32px rgba(0,0,0,0.1)',
          },
          borderRadius: {
            'card': '22px',
            'btn': '16px',
          },
          animation: {
            'spin-slow': 'spin 4s linear infinite',
            'spin-medium': 'spin 2s linear infinite',
            'spin-fast': 'spin 0.8s linear infinite',
            'pulse-gentle': 'pulseGentle 2s ease-in-out infinite',
            'haptic': 'haptic 150ms ease-out',
            'fade-in': 'fadeIn 500ms ease-out forwards',
            'slide-up': 'slideUp 300ms ease-out forwards',
            'toast-in': 'toastIn 300ms ease-out forwards',
            'toast-out': 'toastOut 300ms ease-in forwards',
            'bar-dance': 'barDance 300ms ease-in-out',
            'number-pop': 'numberPop 200ms ease-out',
          },
          keyframes: {
            pulseGentle: {
              '0%, 100%': { opacity: '0.7' },
              '50%': { opacity: '1' },
            },
            haptic: {
              '0%': { transform: 'scale(1)' },
              '50%': { transform: 'scale(0.96)' },
              '100%': { transform: 'scale(1)' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            toastIn: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            toastOut: {
              '0%': { opacity: '1', transform: 'translateY(0)' },
              '100%': { opacity: '0', transform: 'translateY(20px)' },
            },
            barDance: {
              '0%, 100%': { transform: 'scaleY(1)' },
              '50%': { transform: 'scaleY(0.8)' },
            },
            numberPop: {
              '0%': { transform: 'scale(1)' },
              '50%': { transform: 'scale(1.05)' },
              '100%': { transform: 'scale(1)' },
            },
          },
        },
      },
    }
  </script>
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Pretendard', 'Roboto', 'Noto Sans KR', sans-serif; }
    ::-webkit-scrollbar { width: 0; height: 0; }
    .slider-track {
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      cursor: pointer;
      width: 100%;
    }
    .slider-track::-webkit-slider-runnable-track {
      height: 10px;
      border-radius: 8px;
      background: linear-gradient(145deg, #e8e8ea, #fafafa);
      box-shadow: inset 2px 2px 4px rgba(0,0,0,0.08), inset -2px -2px 4px rgba(255,255,255,0.9);
    }
    .slider-track::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: linear-gradient(145deg, #fafafa, #e8e8ea);
      box-shadow: 3px 3px 6px rgba(0,0,0,0.12), -3px -3px 6px rgba(255,255,255,0.9);
      margin-top: -8px;
      border: 2px solid rgba(212,175,55,0.3);
      transition: all 0.15s ease;
    }
    .slider-track::-webkit-slider-thumb:hover {
      border-color: rgba(212,175,55,0.6);
      transform: scale(1.05);
    }
    .slider-track::-webkit-slider-thumb:active {
      box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1), inset -2px -2px 4px rgba(255,255,255,0.6);
    }
    .glass-effect {
      background: rgba(255,255,255,0.65);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.4);
    }
    .donut-bg { stroke: #e8e8ea; }
    .donut-progress { stroke: #84A98C; stroke-linecap: round; transition: stroke-dashoffset 0.5s ease; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .mode-btn.active { background: linear-gradient(145deg, #D4AF37, #c9a432); color: white; box-shadow: 0 4px 15px rgba(212,175,55,0.3); }
    .eq-bar { transition: height 0.25s ease-out; transform-origin: bottom; }
    .eq-bar.disabled { opacity: 0.4; }
    .timeline-item { transition: all 0.2s ease; }
    .timeline-item:active { transform: scale(0.98); }
    #app-container { animation: fadeIn 600ms ease-out forwards; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4" style="background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);">
  <div class="absolute inset-0 backdrop-blur-sm"></div>
  
  <div id="app-container" class="relative w-[390px] h-[844px] bg-off-white rounded-[50px] overflow-hidden shadow-2xl flex flex-col">
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[126px] h-[34px] bg-black rounded-b-[20px] z-50 flex items-center justify-center">
      <div class="w-[10px] h-[10px] rounded-full bg-deep-slate/30 mr-2"></div>
      <div class="w-[60px] h-[6px] rounded-full bg-deep-slate/20"></div>
    </div>
    
    <div class="h-[54px] flex items-end justify-between px-8 pb-1 text-xs font-medium text-deep-slate">
      <span id="status-time">9:41</span>
      <div class="flex items-center gap-1">
        <i class="fas fa-signal text-[10px]"></i>
        <i class="fas fa-wifi text-[10px]"></i>
        <i class="fas fa-battery-full text-[10px]"></i>
      </div>
    </div>
    
    <header id="app-header" class="mx-4 mt-2 p-4 rounded-card bg-off-white shadow-neu-out">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-champagne to-yellow-600 flex items-center justify-center shadow-neu-btn">
            <i class="fas fa-broadcast-tower text-white text-sm"></i>
          </div>
          <div>
            <h1 class="text-base font-bold text-deep-slate tracking-tight">LS Sound-OS</h1>
            <p class="text-[10px] text-deep-slate/50">동기화됨 · 방금</p>
          </div>
        </div>
        <div class="flex items-center gap-3 text-xs text-deep-slate/70">
          <div class="flex items-center gap-1">
            <i class="fas fa-sun text-champagne"></i>
            <span>맑음</span>
          </div>
          <div class="flex items-center gap-1">
            <i class="fas fa-leaf text-sage"></i>
            <span>AQI 좋음</span>
          </div>
        </div>
      </div>
    </header>
    
    <main id="main-content" class="flex-1 overflow-y-auto px-4 pb-4">
      <div id="tab-home" class="tab-content active pt-4 animate-slide-up">
        <div class="relative w-full h-[220px] mb-4 rounded-card bg-off-white shadow-neu-out overflow-hidden">
          <canvas id="ripple-canvas" class="absolute inset-0 w-full h-full"></canvas>
          <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="text-center">
              <p class="text-[10px] text-deep-slate/50 mb-1">실시간 소음 시각화</p>
              <p id="mode-badge" class="text-xs font-semibold text-champagne bg-champagne/10 px-3 py-1 rounded-full">균형 모드</p>
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-3 mb-4">
          <div class="p-4 rounded-card bg-off-white shadow-neu-out text-center">
            <p class="text-[10px] text-deep-slate/50 mb-1">외부 소음 (OUT)</p>
            <p id="out-db" class="text-3xl font-bold text-terra">82<span class="text-base font-normal ml-1">dB</span></p>
            <p class="text-[10px] text-terra/70 mt-1">시끄러움</p>
          </div>
          <div class="p-4 rounded-card bg-off-white shadow-neu-out text-center">
            <p class="text-[10px] text-deep-slate/50 mb-1">실내 소음 (IN)</p>
            <p id="in-db" class="text-3xl font-bold text-sage">42<span class="text-base font-normal ml-1">dB</span></p>
            <p class="text-[10px] text-sage/70 mt-1">쾌적함</p>
          </div>
        </div>
        
        <div class="p-5 rounded-card bg-off-white shadow-neu-out">
          <p class="text-xs text-deep-slate/50 text-center mb-4">마스터 모드 선택</p>
          <div class="flex justify-center gap-2">
            <button id="mode-bunker" class="mode-btn flex-1 py-3 px-2 rounded-btn bg-off-white shadow-neu-btn text-xs font-semibold text-deep-slate transition-all duration-200 active:animate-haptic" aria-label="벙커 모드">
              <i class="fas fa-shield-alt block text-lg mb-1"></i>
              벙커
            </button>
            <button id="mode-guard" class="mode-btn flex-1 py-3 px-2 rounded-btn bg-off-white shadow-neu-btn text-xs font-semibold text-deep-slate transition-all duration-200 active:animate-haptic active" aria-label="가드 모드">
              <i class="fas fa-balance-scale block text-lg mb-1"></i>
              가드
            </button>
            <button id="mode-terrace" class="mode-btn flex-1 py-3 px-2 rounded-btn bg-off-white shadow-neu-btn text-xs font-semibold text-deep-slate transition-all duration-200 active:animate-haptic" aria-label="테라스 모드">
              <i class="fas fa-wind block text-lg mb-1"></i>
              테라스
            </button>
          </div>
          <p id="mode-description" class="text-[10px] text-deep-slate/50 text-center mt-3">외부 소음과 자연음의 균형을 유지합니다</p>
        </div>
      </div>
      
      <div id="tab-mixer" class="tab-content pt-4">
        <div class="p-5 rounded-card bg-off-white shadow-neu-out mb-4">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
              <i class="fas fa-headphones text-champagne"></i>
              <span class="text-sm font-semibold text-deep-slate">ANC 강도</span>
            </div>
            <span id="anc-value" class="text-lg font-bold text-champagne">70%</span>
          </div>
          <input type="range" id="anc-slider" class="slider-track" min="0" max="100" value="70" aria-label="ANC 강도" aria-valuenow="70">
          <div class="flex justify-between text-[10px] text-deep-slate/40 mt-2">
            <span>약함</span>
            <span>강함</span>
          </div>
        </div>
        
        <div class="p-5 rounded-card bg-off-white shadow-neu-out mb-4">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
              <i class="fas fa-volume-up text-sage"></i>
              <span class="text-sm font-semibold text-deep-slate">Pass-Through</span>
            </div>
            <span id="pass-value" class="text-lg font-bold text-sage">Mid</span>
          </div>
          <input type="range" id="pass-slider" class="slider-track" min="0" max="100" value="50" aria-label="Pass-Through 볼륨" aria-valuenow="50">
          <div class="flex justify-between text-[10px] text-deep-slate/40 mt-2">
            <span>Mute</span>
            <span>High</span>
          </div>
        </div>
        
        <div class="p-5 rounded-card bg-off-white shadow-neu-out">
          <p class="text-sm font-semibold text-deep-slate mb-4 flex items-center gap-2">
            <i class="fas fa-sliders text-champagne"></i>
            주파수 이퀄라이저
          </p>
          <div class="flex justify-around items-end h-[120px] mb-4">
            <div class="flex flex-col items-center">
              <div class="w-10 h-[100px] rounded-lg bg-off-white shadow-neu-in flex items-end justify-center p-1 overflow-hidden">
                <div id="eq-low" class="eq-bar w-6 bg-gradient-to-t from-terra to-terra/60 rounded-md" style="height: 60%"></div>
              </div>
              <span class="text-[10px] text-deep-slate/50 mt-2">Low</span>
            </div>
            <div class="flex flex-col items-center">
              <div class="w-10 h-[100px] rounded-lg bg-off-white shadow-neu-in flex items-end justify-center p-1 overflow-hidden">
                <div id="eq-mid" class="eq-bar w-6 bg-gradient-to-t from-champagne to-champagne/60 rounded-md" style="height: 75%"></div>
              </div>
              <span class="text-[10px] text-deep-slate/50 mt-2">Mid</span>
            </div>
            <div class="flex flex-col items-center">
              <div class="w-10 h-[100px] rounded-lg bg-off-white shadow-neu-in flex items-end justify-center p-1 overflow-hidden">
                <div id="eq-high" class="eq-bar w-6 bg-gradient-to-t from-sage to-sage/60 rounded-md" style="height: 50%"></div>
              </div>
              <span class="text-[10px] text-deep-slate/50 mt-2">High</span>
            </div>
          </div>
          <div class="flex justify-around">
            <button id="toggle-low" class="eq-toggle w-12 h-8 rounded-btn bg-off-white shadow-neu-btn text-[10px] font-semibold text-sage active:animate-haptic" data-active="true">ON</button>
            <button id="toggle-mid" class="eq-toggle w-12 h-8 rounded-btn bg-off-white shadow-neu-btn text-[10px] font-semibold text-sage active:animate-haptic" data-active="true">ON</button>
            <button id="toggle-high" class="eq-toggle w-12 h-8 rounded-btn bg-off-white shadow-neu-btn text-[10px] font-semibold text-sage active:animate-haptic" data-active="true">ON</button>
          </div>
        </div>
      </div>
      
      <div id="tab-care" class="tab-content pt-4">
        <div class="p-5 rounded-card bg-off-white shadow-neu-out mb-4">
          <p class="text-sm font-semibold text-deep-slate mb-4 flex items-center gap-2">
            <i class="fas fa-fan text-champagne"></i>
            스마트 환기 시스템
          </p>
          <div class="flex items-center justify-center mb-5">
            <div class="w-24 h-24 rounded-full bg-off-white shadow-neu-out flex items-center justify-center">
              <i id="fan-icon" class="fas fa-fan text-4xl text-champagne animate-spin-medium"></i>
            </div>
          </div>
          <div class="flex justify-center gap-2">
            <button id="fan-silent" class="fan-btn flex-1 py-3 px-2 rounded-btn bg-off-white shadow-neu-btn text-xs font-semibold text-deep-slate transition-all duration-200 active:animate-haptic" aria-label="저소음 모드">
              <i class="fas fa-moon block text-base mb-1"></i>
              Silent
            </button>
            <button id="fan-auto" class="fan-btn flex-1 py-3 px-2 rounded-btn bg-off-white shadow-neu-btn text-xs font-semibold text-deep-slate transition-all duration-200 active:animate-haptic active" aria-label="자동 모드">
              <i class="fas fa-magic block text-base mb-1"></i>
              Auto
            </button>
            <button id="fan-turbo" class="fan-btn flex-1 py-3 px-2 rounded-btn bg-off-white shadow-neu-btn text-xs font-semibold text-deep-slate transition-all duration-200 active:animate-haptic" aria-label="터보 모드">
              <i class="fas fa-bolt block text-base mb-1"></i>
              Turbo
            </button>
          </div>
          <p id="fan-status" class="text-[10px] text-deep-slate/50 text-center mt-3">자동으로 최적의 환기량을 조절합니다</p>
        </div>
        
        <div class="p-5 rounded-card bg-off-white shadow-neu-out">
          <p class="text-sm font-semibold text-deep-slate mb-4 flex items-center gap-2">
            <i class="fas fa-filter text-sage"></i>
            필터 상태
          </p>
          <div class="flex items-center justify-center">
            <div class="relative w-36 h-36">
              <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                <circle class="donut-bg" cx="50" cy="50" r="42" fill="none" stroke-width="12"/>
                <circle id="filter-progress" class="donut-progress" cx="50" cy="50" r="42" fill="none" stroke-width="12" stroke-dasharray="264" stroke-dashoffset="47.5"/>
              </svg>
              <div class="absolute inset-0 flex flex-col items-center justify-center">
                <span class="text-2xl font-bold text-sage">82%</span>
                <span class="text-[10px] text-deep-slate/50">필터 양호</span>
              </div>
            </div>
          </div>
          <div class="mt-4 p-3 rounded-btn bg-sage/10 text-center">
            <p class="text-xs text-sage font-medium">예상 교체일: 2025년 4월 15일</p>
          </div>
        </div>
      </div>
      
      <div id="tab-security" class="tab-content pt-4">
        <div class="p-4 rounded-card bg-off-white shadow-neu-out mb-4">
          <div class="flex items-center justify-between mb-3">
            <p class="text-sm font-semibold text-deep-slate flex items-center gap-2">
              <i class="fas fa-shield text-sage"></i>
              Audio Blackbox
            </p>
            <span class="text-[10px] text-deep-slate/50">최근 24시간</span>
          </div>
          <div id="timeline-list" class="space-y-2">
          </div>
        </div>
        <div class="p-4 rounded-card bg-off-white shadow-neu-out">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-semibold text-deep-slate">녹음 저장 용량</p>
              <p class="text-[10px] text-deep-slate/50">12.4 GB / 32 GB 사용 중</p>
            </div>
            <div class="w-20 h-2 rounded-full bg-off-white shadow-neu-in overflow-hidden">
              <div class="h-full w-[39%] bg-gradient-to-r from-sage to-champagne rounded-full"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <nav id="tab-bar" class="glass-effect mx-3 mb-4 rounded-[28px] p-2 shadow-glass">
      <div class="flex justify-around">
        <button class="tab-btn flex flex-col items-center py-2 px-4 rounded-xl transition-all duration-200 active:animate-haptic text-champagne" data-tab="home" aria-label="홈">
          <i class="fas fa-home text-lg mb-1"></i>
          <span class="text-[10px] font-medium">홈</span>
        </button>
        <button class="tab-btn flex flex-col items-center py-2 px-4 rounded-xl transition-all duration-200 active:animate-haptic text-deep-slate/50" data-tab="mixer" aria-label="믹서">
          <i class="fas fa-sliders text-lg mb-1"></i>
          <span class="text-[10px] font-medium">믹서</span>
        </button>
        <button class="tab-btn flex flex-col items-center py-2 px-4 rounded-xl transition-all duration-200 active:animate-haptic text-deep-slate/50" data-tab="care" aria-label="케어">
          <i class="fas fa-heartbeat text-lg mb-1"></i>
          <span class="text-[10px] font-medium">케어</span>
        </button>
        <button class="tab-btn flex flex-col items-center py-2 px-4 rounded-xl transition-all duration-200 active:animate-haptic text-deep-slate/50" data-tab="security" aria-label="보안">
          <i class="fas fa-lock text-lg mb-1"></i>
          <span class="text-[10px] font-medium">보안</span>
        </button>
      </div>
    </nav>
    
    <div id="toast-container" class="absolute bottom-24 left-4 right-4 z-50 pointer-events-none"></div>
  </div>

  <script>
  (function() {
    const state = {
      currentTab: 'home',
      mode: 'guard',
      outDb: 82,
      inDb: 42,
      ancStrength: 70,
      passThrough: 50,
      eqEnabled: { low: true, mid: true, high: true },
      fanMode: 'auto',
      playingAudio: null,
    };

    const modeConfig = {
      bunker: { inMin: 28, inMax: 35, label: '벙커', badge: '차단 우선', desc: '외부 소음을 최대한 차단합니다', speed: 0.3, roughness: 0.2, tint: [132, 169, 140] },
      guard: { inMin: 38, inMax: 48, label: '가드', badge: '균형 모드', desc: '외부 소음과 자연음의 균형을 유지합니다', speed: 0.6, roughness: 0.5, tint: [212, 175, 55] },
      terrace: { inMin: 48, inMax: 60, label: '테라스', badge: '개방 우선', desc: '자연의 소리를 최대한 전달합니다', speed: 1.0, roughness: 0.8, tint: [224, 122, 95] },
    };

    const securityEvents = [
      { time: '14:32', label: '비명 소리 감지', severity: 'warning' },
      { time: '13:15', label: '경적 소리', severity: 'safe' },
      { time: '11:48', label: '유리 파손 의심', severity: 'warning' },
      { time: '10:22', label: '큰 충격음', severity: 'warning' },
      { time: '09:05', label: '문 닫히는 소리', severity: 'safe' },
      { time: '08:30', label: '차량 경보음', severity: 'safe' },
      { time: '07:15', label: '반려동물 짖는 소리', severity: 'safe' },
      { time: '06:45', label: '알람 소리', severity: 'safe' },
    ];

    let intervals = { db: null, eq: null };
    let canvas, ctx, ripples = [], animationId;

    function init() {
      updateStatusTime();
      setInterval(updateStatusTime, 1000);
      bindEvents();
      renderAll();
      startIntervals();
      initCanvas();
    }

    function updateStatusTime() {
      const now = new Date();
      const h = now.getHours();
      const m = now.getMinutes().toString().padStart(2, '0');
      document.getElementById('status-time').textContent = `${h}:${m}`;
    }

    function bindEvents() {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => switchTab(btn.dataset.tab));
      });
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const mode = btn.id.replace('mode-', '');
          setMode(mode);
        });
      });
      document.getElementById('anc-slider').addEventListener('input', (e) => {
        state.ancStrength = parseInt(e.target.value);
        renderMixer();
      });
      document.getElementById('pass-slider').addEventListener('input', (e) => {
        state.passThrough = parseInt(e.target.value);
        renderMixer();
      });
      document.querySelectorAll('.eq-toggle').forEach(btn => {
        btn.addEventListener('click', () => {
          const band = btn.id.replace('toggle-', '');
          state.eqEnabled[band] = !state.eqEnabled[band];
          renderMixer();
        });
      });
      document.querySelectorAll('.fan-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const mode = btn.id.replace('fan-', '');
          setFanMode(mode);
        });
      });
    }

    function switchTab(tab) {
      state.currentTab = tab;
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.getElementById(`tab-${tab}`).classList.add('active');
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.toggle('text-champagne', btn.dataset.tab === tab);
        btn.classList.toggle('text-deep-slate/50', btn.dataset.tab !== tab);
      });
      renderAll();
    }

    function setMode(mode) {
      state.mode = mode;
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.toggle('active', btn.id === `mode-${mode}`);
      });
      document.getElementById('mode-badge').textContent = modeConfig[mode].badge;
      document.getElementById('mode-description').textContent = modeConfig[mode].desc;
      updateDbValues();
    }

    function setFanMode(mode) {
      state.fanMode = mode;
      document.querySelectorAll('.fan-btn').forEach(btn => {
        btn.classList.toggle('active', btn.id === `fan-${mode}`);
        if (btn.id === `fan-${mode}`) {
          btn.classList.add('bg-gradient-to-br', 'from-champagne', 'to-yellow-600', 'text-white');
          btn.classList.add('shadow-lg');
        } else {
          btn.classList.remove('bg-gradient-to-br', 'from-champagne', 'to-yellow-600', 'text-white');
          btn.classList.remove('shadow-lg');
        }
      });
      const fanIcon = document.getElementById('fan-icon');
      fanIcon.classList.remove('animate-spin-slow', 'animate-spin-medium', 'animate-spin-fast');
      const statusText = document.getElementById('fan-status');
      if (mode === 'silent') {
        fanIcon.classList.add('animate-spin-slow');
        statusText.textContent = '저소음 모드로 조용히 작동합니다';
      } else if (mode === 'auto') {
        fanIcon.classList.add('animate-spin-medium');
        statusText.textContent = '자동으로 최적의 환기량을 조절합니다';
      } else {
        fanIcon.classList.add('animate-spin-fast');
        statusText.textContent = '최대 출력으로 빠르게 환기합니다';
      }
    }

    function updateDbValues() {
      state.outDb = Math.floor(Math.random() * 16) + 75;
      const cfg = modeConfig[state.mode];
      state.inDb = Math.floor(Math.random() * (cfg.inMax - cfg.inMin + 1)) + cfg.inMin;
      renderHome();
    }

    function renderAll() {
      if (state.currentTab === 'home') renderHome();
      else if (state.currentTab === 'mixer') renderMixer();
      else if (state.currentTab === 'care') renderCare();
      else if (state.currentTab === 'security') renderSecurity();
    }

    function renderHome() {
      const outEl = document.getElementById('out-db');
      const inEl = document.getElementById('in-db');
      outEl.innerHTML = `${state.outDb}<span class="text-base font-normal ml-1">dB</span>`;
      inEl.innerHTML = `${state.inDb}<span class="text-base font-normal ml-1">dB</span>`;
      outEl.classList.add('animate-number-pop');
      inEl.classList.add('animate-number-pop');
      setTimeout(() => {
        outEl.classList.remove('animate-number-pop');
        inEl.classList.remove('animate-number-pop');
      }, 200);
    }

    function renderMixer() {
      document.getElementById('anc-value').textContent = `${state.ancStrength}%`;
      document.getElementById('anc-slider').setAttribute('aria-valuenow', state.ancStrength);
      const pt = state.passThrough;
      let ptLabel = 'Mute';
      if (pt >= 1 && pt <= 35) ptLabel = 'Low';
      else if (pt >= 36 && pt <= 70) ptLabel = 'Mid';
      else if (pt >= 71) ptLabel = 'High';
      document.getElementById('pass-value').textContent = ptLabel;
      document.getElementById('pass-slider').setAttribute('aria-valuenow', pt);
      ['low', 'mid', 'high'].forEach(band => {
        const bar = document.getElementById(`eq-${band}`);
        const btn = document.getElementById(`toggle-${band}`);
        const enabled = state.eqEnabled[band];
        bar.classList.toggle('disabled', !enabled);
        btn.textContent = enabled ? 'ON' : 'OFF';
        btn.classList.toggle('text-sage', enabled);
        btn.classList.toggle('text-deep-slate/40', !enabled);
        if (!enabled) bar.style.height = '15%';
      });
    }

    function renderCare() {
      setFanMode(state.fanMode);
    }

    function renderSecurity() {
      const list = document.getElementById('timeline-list');
      list.innerHTML = securityEvents.map((evt, idx) => `
        <div class="timeline-item flex items-center gap-3 p-3 rounded-btn bg-off-white shadow-neu-btn cursor-pointer" data-index="${idx}">
          <div class="w-10 h-10 rounded-full ${evt.severity === 'warning' ? 'bg-terra/15' : 'bg-sage/15'} flex items-center justify-center">
            <i class="fas ${evt.severity === 'warning' ? 'fa-exclamation-triangle text-terra' : 'fa-check text-sage'} text-sm"></i>
          </div>
          <div class="flex-1">
            <p class="text-xs font-semibold text-deep-slate">${evt.label}</p>
            <p class="text-[10px] text-deep-slate/50">오늘 ${evt.time}</p>
          </div>
          <button class="play-btn w-9 h-9 rounded-full bg-off-white shadow-neu-btn flex items-center justify-center active:animate-haptic" data-index="${idx}" aria-label="재생">
            <i class="fas fa-play text-xs text-champagne"></i>
          </button>
        </div>
      `).join('');
      list.querySelectorAll('.play-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleAudioPlay(parseInt(btn.dataset.index));
        });
      });
    }

    function toggleAudioPlay(index) {
      const btns = document.querySelectorAll('.play-btn');
      if (state.playingAudio === index) {
        state.playingAudio = null;
        btns[index].innerHTML = '<i class="fas fa-play text-xs text-champagne"></i>';
      } else {
        btns.forEach((btn, i) => {
          btn.innerHTML = '<i class="fas fa-play text-xs text-champagne"></i>';
        });
        state.playingAudio = index;
        btns[index].innerHTML = '<i class="fas fa-pause text-xs text-champagne"></i>';
        showToast('오디오 재생 중…');
        setTimeout(() => {
          if (state.playingAudio === index) {
            state.playingAudio = null;
            btns[index].innerHTML = '<i class="fas fa-play text-xs text-champagne"></i>';
          }
        }, 3000);
      }
    }

    function showToast(message) {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'glass-effect rounded-btn px-4 py-3 shadow-glass animate-toast-in text-center';
      toast.innerHTML = `<p class="text-xs font-medium text-deep-slate">${message}</p>`;
      container.innerHTML = '';
      container.appendChild(toast);
      setTimeout(() => {
        toast.classList.remove('animate-toast-in');
        toast.classList.add('animate-toast-out');
        setTimeout(() => toast.remove(), 300);
      }, 2700);
    }

    function startIntervals() {
      intervals.db = setInterval(updateDbValues, 500);
      intervals.eq = setInterval(updateEqBars, 250);
    }

    function updateEqBars() {
      ['low', 'mid', 'high'].forEach(band => {
        if (state.eqEnabled[band]) {
          const bar = document.getElementById(`eq-${band}`);
          const h = Math.floor(Math.random() * 60) + 25;
          bar.style.height = `${h}%`;
        }
      });
    }

    function initCanvas() {
      canvas = document.getElementById('ripple-canvas');
      ctx = canvas.getContext('2d');
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      animateRipples();
    }

    function resizeCanvas() {
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width * window.devicePixelRatio;
      canvas.height = rect.height * window.devicePixelRatio;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
      ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
    }

    function animateRipples() {
      const rect = canvas.getBoundingClientRect();
      const w = rect.width;
      const h = rect.height;
      const cx = w / 2;
      const cy = h / 2;
      ctx.clearRect(0, 0, w, h);
      const cfg = modeConfig[state.mode];
      const speed = cfg.speed;
      const roughness = cfg.roughness;
      const tint = cfg.tint;
      const maxRipples = 5;
      if (ripples.length < maxRipples && Math.random() < 0.03 * speed) {
        ripples.push({ r: 10, alpha: 0.6 });
      }
      ripples = ripples.filter(rip => rip.alpha > 0.01);
      ripples.forEach(rip => {
        rip.r += 0.8 + speed * 1.2;
        rip.alpha -= 0.004 + speed * 0.002;
        const jitter = roughness * Math.sin(rip.r * 0.1 + Date.now() * 0.002) * 3;
        ctx.beginPath();
        ctx.arc(cx, cy, rip.r + jitter, 0, Math.PI * 2);
        ctx.strokeStyle = `rgba(${tint[0]}, ${tint[1]}, ${tint[2]}, ${rip.alpha * 0.5})`;
        ctx.lineWidth = 2 + roughness * 2;
        ctx.stroke();
      });
      const intensity = (state.outDb - 75) / 15;
      const pulseSize = 30 + intensity * 20 + Math.sin(Date.now() * 0.003 * speed) * 8;
      const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, pulseSize);
      gradient.addColorStop(0, `rgba(${tint[0]}, ${tint[1]}, ${tint[2]}, 0.25)`);
      gradient.addColorStop(1, `rgba(${tint[0]}, ${tint[1]}, ${tint[2]}, 0)`);
      ctx.beginPath();
      ctx.arc(cx, cy, pulseSize, 0, Math.PI * 2);
      ctx.fillStyle = gradient;
      ctx.fill();
      animationId = requestAnimationFrame(animateRipples);
    }

    document.addEventListener('DOMContentLoaded', init);
  })();
  </script>
</body>
</html>
